<!DOCTYPE html>
<html>
<head>
    <title>Test Client-Side Routing</title>
    <script src="https://unpkg.com/puppeteer-in-browser/dist/puppeteer-in-browser.js"></script>
</head>
<body>
    <h1>Testing Next.js Button Navigation</h1>
    
    <button onclick="testButtons()">Test All Buttons on Homepage</button>
    <button onclick="checkJavaScript()">Check JavaScript Status</button>
    
    <div id="results"></div>
    
    <iframe id="testFrame" src="http://localhost:3000" width="100%" height="400" style="border: 1px solid #ccc; margin-top: 20px;"></iframe>
    
    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'blue';
            results.innerHTML += `<p style="color: ${color};">${new Date().toLocaleTimeString()}: ${message}</p>`;
        }
        
        function checkJavaScript() {
            try {
                const frame = document.getElementById('testFrame');
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                
                // Check if JavaScript is enabled
                const scripts = frameDoc.querySelectorAll('script');
                log(`Found ${scripts.length} script tags`, 'info');
                
                // Check for Next.js
                if (frame.contentWindow.__NEXT_DATA__) {
                    log('✓ Next.js is loaded and running', 'success');
                    log(`Build ID: ${frame.contentWindow.__NEXT_DATA__.buildId}`, 'info');
                } else {
                    log('✗ Next.js data not found', 'error');
                }
                
                // Check for React
                if (frame.contentWindow.React) {
                    log('✓ React is available', 'success');
                } else {
                    log('✗ React not found in iframe', 'error');
                }
                
            } catch (e) {
                log(`Error accessing iframe: ${e.message}`, 'error');
            }
        }
        
        function testButtons() {
            try {
                const frame = document.getElementById('testFrame');
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                
                const buttons = frameDoc.querySelectorAll('button');
                log(`Found ${buttons.length} buttons in the page`, 'info');
                
                buttons.forEach((button, index) => {
                    const text = button.textContent.trim();
                    log(`Button ${index + 1}: "${text}"`, 'info');
                    
                    // Check for React fiber
                    const reactFiber = Object.keys(button).find(key => 
                        key.startsWith('__reactFiber') || 
                        key.startsWith('__reactInternalInstance')
                    );
                    
                    if (reactFiber) {
                        log(`  ✓ Button has React event handlers attached`, 'success');
                        
                        // Try to simulate click
                        const event = new MouseEvent('click', {
                            view: frame.contentWindow,
                            bubbles: true,
                            cancelable: true
                        });
                        
                        button.dispatchEvent(event);
                        log(`  → Click event dispatched`, 'info');
                        
                        // Check if URL changed after a short delay
                        setTimeout(() => {
                            if (frame.contentWindow.location.pathname !== '/') {
                                log(`  ✓ Navigation successful to: ${frame.contentWindow.location.pathname}`, 'success');
                            } else {
                                log(`  ✗ URL did not change after click`, 'error');
                            }
                        }, 500);
                        
                    } else {
                        log(`  ✗ No React handlers found`, 'error');
                    }
                });
                
            } catch (e) {
                log(`Error testing buttons: ${e.message}`, 'error');
            }
        }
        
        // Auto-check after iframe loads
        document.getElementById('testFrame').onload = function() {
            log('Iframe loaded, waiting for React to initialize...', 'info');
            setTimeout(checkJavaScript, 2000);
        };
    </script>
</body>
</html>